global:
  scrape_interval: 15s

scrape_configs:
  - job_name: "kubernetes-apps"
    kubernetes_sd_configs:
      - role: endpoints

    relabel_configs:
      # Keep only our application services
      - source_labels: [__meta_kubernetes_service_name]
        action: keep
        regex: api-node|core-go|worker-python

      # Use the service port name if defined (optional safety)
      - source_labels: [__meta_kubernetes_endpoint_port_name]
        action: keep
        regex: http|metrics|web|.*

      # Set job label to service name
      - source_labels: [__meta_kubernetes_service_name]
        target_label: job

      # Add namespace label
      - source_labels: [__meta_kubernetes_namespace]
        target_label: namespace

